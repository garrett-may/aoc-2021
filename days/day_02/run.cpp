#include <array>
#include <experimental/array>
#include <concepts>

#include <iostream>

template<std::integral T>
constexpr T str_to_int(char const* str, char const** endptr) noexcept{
    T i = 0;
    for(; *str != '\0'; ++str){
        char c = *str;
        if('0' <= c && c <= '9'){
            i = i * 10 + (c - '0');
        } else{
            if(endptr){
                *endptr = str;
            }
            return i;
        }
    }
    if(endptr){
        *endptr = str;
    }
    return i;
}

struct position_t{
    std::size_t horizontal;
    std::size_t depth;
    std::size_t aim;
};

template<auto go_forward, auto go_down, auto go_up>
constexpr void parse_command(char const* command, position_t& position) noexcept{
    switch(command[0]){
        case 'f': 
            go_forward(command, position);
            break;            
        case 'd': 
            go_down(command, position);
            break;
        case 'u':
            go_up(command, position);
            break;
        default:
            break;
    }
}

template<auto go_forward, auto go_down, auto go_up>
constexpr std::size_t parse(auto const& commands) noexcept{
    position_t position{0, 0, 0};
    for(auto const* command : commands){
        parse_command<go_forward, go_down, go_up>(command, position);
    }
    return position.horizontal * position.depth;
}

constexpr static auto input_example = std::experimental::make_array(
    "forward 5",
    "down 5",
    "forward 8",
    "up 3",
    "down 8",
    "forward 2"
);

constexpr static auto input = std::experimental::make_array(
    "forward 8",
    "down 9",
    "up 1",
    "forward 2",
    "down 6",
    "forward 6",
    "down 5",
    "down 4",
    "down 2",
    "forward 3",
    "forward 8",
    "down 6",
    "up 3",
    "up 3",
    "down 5",
    "up 8",
    "forward 8",
    "up 6",
    "forward 4",
    "down 8",
    "up 2",
    "up 6",
    "forward 7",
    "up 6",
    "down 6",
    "down 1",
    "forward 8",
    "up 7",
    "forward 9",
    "forward 5",
    "forward 8",
    "forward 5",
    "down 3",
    "forward 5",
    "up 1",
    "forward 6",
    "forward 3",
    "forward 3",
    "down 2",
    "forward 4",
    "down 3",
    "forward 6",
    "forward 2",
    "forward 1",
    "down 2",
    "forward 1",
    "down 1",
    "up 8",
    "down 4",
    "forward 3",
    "up 3",
    "down 5",
    "down 2",
    "forward 7",
    "forward 1",
    "down 9",
    "up 1",
    "down 1",
    "forward 2",
    "forward 1",
    "forward 1",
    "forward 7",
    "up 5",
    "forward 2",
    "down 6",
    "down 7",
    "down 3",
    "down 1",
    "forward 4",
    "forward 5",
    "down 3",
    "forward 4",
    "down 5",
    "forward 3",
    "forward 4",
    "forward 2",
    "up 8",
    "down 7",
    "up 3",
    "forward 2",
    "down 5",
    "forward 9",
    "forward 5",
    "up 1",
    "down 5",
    "down 6",
    "forward 2",
    "forward 5",
    "down 6",
    "down 1",
    "up 8",
    "up 9",
    "down 7",
    "down 5",
    "forward 2",
    "forward 7",
    "forward 7",
    "up 6",
    "down 4",
    "up 6",
    "forward 2",
    "down 4",
    "down 3",
    "down 4",
    "forward 2",
    "down 2",
    "down 1",
    "down 4",
    "up 4",
    "forward 7",
    "forward 6",
    "forward 2",
    "forward 5",
    "forward 1",
    "forward 7",
    "forward 2",
    "down 3",
    "forward 7",
    "forward 2",
    "up 4",
    "up 5",
    "down 1",
    "down 2",
    "down 3",
    "down 7",
    "up 8",
    "forward 4",
    "down 5",
    "down 4",
    "forward 3",
    "down 6",
    "forward 5",
    "up 5",
    "forward 6",
    "down 1",
    "down 7",
    "forward 1",
    "forward 6",
    "up 9",
    "forward 2",
    "down 1",
    "forward 5",
    "forward 2",
    "forward 6",
    "forward 8",
    "forward 6",
    "down 8",
    "forward 3",
    "down 9",
    "up 8",
    "forward 9",
    "down 7",
    "down 6",
    "down 1",
    "up 5",
    "down 6",
    "forward 7",
    "up 9",
    "forward 8",
    "forward 3",
    "forward 3",
    "forward 2",
    "down 6",
    "up 1",
    "up 5",
    "forward 7",
    "down 2",
    "down 5",
    "down 1",
    "down 4",
    "forward 8",
    "forward 2",
    "forward 8",
    "up 5",
    "forward 7",
    "up 7",
    "forward 6",
    "forward 9",
    "up 1",
    "down 4",
    "forward 8",
    "forward 4",
    "down 9",
    "up 6",
    "down 8",
    "up 9",
    "down 2",
    "down 2",
    "down 9",
    "up 3",
    "down 7",
    "down 2",
    "up 9",
    "forward 9",
    "down 5",
    "forward 2",
    "forward 1",
    "forward 2",
    "down 4",
    "forward 4",
    "down 2",
    "forward 8",
    "up 3",
    "forward 6",
    "up 7",
    "up 9",
    "forward 4",
    "up 9",
    "down 5",
    "forward 5",
    "up 6",
    "down 2",
    "down 4",
    "forward 1",
    "down 2",
    "forward 3",
    "down 7",
    "down 1",
    "down 5",
    "forward 5",
    "up 5",
    "forward 3",
    "down 5",
    "forward 7",
    "down 3",
    "down 2",
    "up 9",
    "down 4",
    "forward 4",
    "down 4",
    "forward 1",
    "up 9",
    "down 8",
    "forward 2",
    "down 7",
    "forward 8",
    "down 5",
    "up 2",
    "down 9",
    "down 2",
    "up 4",
    "up 2",
    "forward 8",
    "forward 3",
    "forward 4",
    "down 1",
    "down 3",
    "forward 3",
    "down 8",
    "forward 7",
    "down 7",
    "forward 5",
    "forward 5",
    "up 3",
    "down 6",
    "forward 1",
    "down 4",
    "forward 2",
    "down 4",
    "up 2",
    "down 3",
    "forward 4",
    "forward 6",
    "up 7",
    "down 3",
    "forward 7",
    "forward 1",
    "down 1",
    "up 3",
    "down 7",
    "up 3",
    "up 8",
    "up 7",
    "up 7",
    "forward 7",
    "down 2",
    "forward 6",
    "forward 7",
    "up 3",
    "down 3",
    "up 9",
    "down 6",
    "down 7",
    "down 7",
    "up 5",
    "forward 6",
    "forward 2",
    "up 9",
    "forward 2",
    "down 3",
    "down 3",
    "forward 5",
    "forward 3",
    "forward 6",
    "forward 6",
    "down 7",
    "forward 2",
    "down 3",
    "up 4",
    "forward 1",
    "forward 5",
    "down 5",
    "up 1",
    "down 9",
    "forward 3",
    "up 6",
    "forward 5",
    "down 4",
    "forward 9",
    "up 5",
    "forward 7",
    "up 7",
    "forward 9",
    "forward 2",
    "forward 6",
    "forward 3",
    "forward 3",
    "up 7",
    "down 1",
    "down 1",
    "forward 1",
    "down 8",
    "down 2",
    "forward 4",
    "up 7",
    "forward 7",
    "down 5",
    "down 7",
    "up 6",
    "down 4",
    "forward 4",
    "forward 4",
    "up 7",
    "down 9",
    "forward 6",
    "forward 1",
    "down 7",
    "forward 5",
    "forward 2",
    "forward 1",
    "up 7",
    "down 9",
    "forward 2",
    "down 7",
    "up 8",
    "forward 1",
    "forward 4",
    "up 4",
    "forward 1",
    "down 9",
    "down 5",
    "down 8",
    "forward 8",
    "forward 8",
    "down 8",
    "down 3",
    "down 5",
    "down 6",
    "up 9",
    "forward 1",
    "down 1",
    "forward 1",
    "forward 1",
    "down 6",
    "forward 3",
    "down 1",
    "forward 9",
    "forward 3",
    "up 7",
    "down 9",
    "forward 5",
    "down 4",
    "up 9",
    "down 2",
    "down 5",
    "down 6",
    "forward 1",
    "up 2",
    "forward 9",
    "up 7",
    "forward 2",
    "forward 8",
    "down 5",
    "down 6",
    "down 8",
    "forward 4",
    "down 4",
    "forward 9",
    "forward 3",
    "forward 6",
    "forward 9",
    "up 2",
    "down 8",
    "up 2",
    "up 6",
    "up 5",
    "down 5",
    "down 7",
    "forward 1",
    "up 6",
    "forward 9",
    "up 4",
    "forward 4",
    "up 2",
    "forward 3",
    "down 8",
    "down 1",
    "up 5",
    "forward 5",
    "down 3",
    "down 4",
    "down 1",
    "forward 3",
    "up 2",
    "forward 3",
    "down 1",
    "forward 8",
    "up 3",
    "forward 4",
    "down 3",
    "forward 6",
    "down 9",
    "down 7",
    "forward 3",
    "forward 5",
    "forward 1",
    "forward 3",
    "up 8",
    "forward 2",
    "forward 2",
    "forward 7",
    "up 9",
    "forward 4",
    "down 1",
    "down 6",
    "forward 8",
    "forward 5",
    "up 4",
    "up 5",
    "up 9",
    "forward 9",
    "up 8",
    "down 3",
    "up 5",
    "forward 1",
    "forward 5",
    "up 9",
    "forward 8",
    "forward 4",
    "forward 3",
    "forward 1",
    "forward 6",
    "down 2",
    "up 8",
    "down 7",
    "down 1",
    "down 5",
    "up 1",
    "forward 9",
    "down 2",
    "down 4",
    "forward 3",
    "forward 1",
    "down 7",
    "up 9",
    "up 7",
    "down 2",
    "down 4",
    "down 1",
    "forward 9",
    "up 4",
    "down 9",
    "down 9",
    "down 4",
    "down 9",
    "forward 1",
    "down 2",
    "forward 8",
    "up 4",
    "up 3",
    "forward 4",
    "down 5",
    "forward 8",
    "forward 2",
    "forward 4",
    "up 3",
    "up 2",
    "up 3",
    "forward 4",
    "forward 4",
    "forward 6",
    "down 7",
    "down 8",
    "up 3",
    "down 9",
    "down 5",
    "up 7",
    "up 1",
    "down 3",
    "down 4",
    "up 5",
    "up 9",
    "down 2",
    "up 8",
    "forward 9",
    "down 3",
    "forward 4",
    "down 5",
    "down 1",
    "forward 9",
    "forward 2",
    "up 3",
    "down 9",
    "down 8",
    "up 7",
    "forward 2",
    "down 9",
    "up 8",
    "up 2",
    "down 3",
    "forward 3",
    "forward 3",
    "forward 3",
    "forward 4",
    "down 7",
    "up 2",
    "forward 3",
    "forward 7",
    "forward 5",
    "forward 7",
    "down 6",
    "down 9",
    "down 6",
    "down 8",
    "up 4",
    "down 4",
    "down 2",
    "up 1",
    "down 3",
    "forward 7",
    "forward 5",
    "down 7",
    "forward 1",
    "up 7",
    "forward 9",
    "down 8",
    "down 1",
    "down 3",
    "down 1",
    "up 8",
    "forward 7",
    "up 5",
    "forward 6",
    "down 1",
    "down 8",
    "up 1",
    "up 9",
    "forward 7",
    "down 9",
    "forward 3",
    "forward 8",
    "forward 7",
    "down 3",
    "down 5",
    "up 3",
    "up 7",
    "up 3",
    "up 6",
    "up 8",
    "down 3",
    "forward 7",
    "down 7",
    "forward 9",
    "up 9",
    "down 1",
    "down 3",
    "down 8",
    "down 6",
    "forward 1",
    "up 6",
    "down 1",
    "up 4",
    "down 2",
    "forward 9",
    "up 8",
    "up 2",
    "down 6",
    "down 1",
    "forward 2",
    "forward 6",
    "forward 1",
    "forward 2",
    "up 6",
    "down 7",
    "down 8",
    "forward 9",
    "up 2",
    "down 6",
    "down 8",
    "down 5",
    "up 6",
    "forward 6",
    "down 5",
    "forward 4",
    "forward 2",
    "down 1",
    "down 4",
    "up 5",
    "down 5",
    "down 1",
    "down 9",
    "down 1",
    "down 1",
    "forward 1",
    "forward 5",
    "up 4",
    "down 5",
    "down 3",
    "down 2",
    "down 7",
    "forward 5",
    "forward 6",
    "forward 2",
    "up 9",
    "up 3",
    "forward 6",
    "down 4",
    "forward 8",
    "forward 4",
    "forward 9",
    "down 6",
    "down 9",
    "down 1",
    "forward 6",
    "down 8",
    "down 7",
    "forward 5",
    "down 4",
    "forward 5",
    "forward 5",
    "up 3",
    "down 1",
    "down 4",
    "forward 1",
    "forward 7",
    "down 5",
    "down 4",
    "forward 7",
    "forward 3",
    "forward 4",
    "down 4",
    "forward 8",
    "up 2",
    "up 6",
    "down 9",
    "up 1",
    "down 8",
    "up 2",
    "up 6",
    "forward 5",
    "forward 7",
    "up 4",
    "down 4",
    "down 8",
    "forward 5",
    "up 4",
    "down 6",
    "forward 9",
    "up 4",
    "forward 7",
    "up 7",
    "down 3",
    "down 2",
    "down 2",
    "down 6",
    "down 4",
    "forward 4",
    "down 3",
    "down 4",
    "down 4",
    "down 8",
    "up 2",
    "down 3",
    "forward 5",
    "forward 5",
    "up 5",
    "forward 1",
    "down 7",
    "forward 5",
    "forward 7",
    "forward 9",
    "forward 4",
    "down 1",
    "down 1",
    "up 5",
    "down 6",
    "down 8",
    "down 9",
    "down 9",
    "forward 7",
    "down 6",
    "forward 3",
    "down 7",
    "up 3",
    "forward 5",
    "forward 5",
    "up 6",
    "down 5",
    "down 8",
    "down 5",
    "down 1",
    "down 7",
    "forward 8",
    "up 9",
    "forward 2",
    "up 1",
    "down 9",
    "down 2",
    "forward 7",
    "up 1",
    "down 5",
    "forward 3",
    "up 6",
    "forward 9",
    "up 9",
    "down 3",
    "forward 2",
    "up 6",
    "down 6",
    "up 8",
    "down 3",
    "up 5",
    "forward 9",
    "up 3",
    "forward 4",
    "forward 6",
    "down 3",
    "forward 4",
    "down 5",
    "down 7",
    "down 7",
    "forward 9",
    "forward 6",
    "down 9",
    "up 1",
    "forward 2",
    "down 8",
    "down 7",
    "up 7",
    "forward 6",
    "up 5",
    "down 6",
    "forward 6",
    "down 3",
    "forward 2",
    "down 7",
    "forward 2",
    "down 3",
    "down 8",
    "forward 4",
    "up 8",
    "forward 7",
    "down 4",
    "forward 3",
    "down 3",
    "forward 6",
    "down 7",
    "down 7",
    "forward 8",
    "forward 9",
    "down 8",
    "down 4",
    "forward 5",
    "down 1",
    "forward 9",
    "down 7",
    "up 3",
    "down 6",
    "down 4",
    "down 9",
    "forward 3",
    "down 1",
    "forward 1",
    "down 5",
    "forward 1",
    "forward 9",
    "down 9",
    "forward 5",
    "down 1",
    "up 9",
    "down 3",
    "down 2",
    "up 6",
    "forward 4",
    "down 6",
    "down 2",
    "forward 5",
    "up 8",
    "down 7",
    "up 6",
    "down 1",
    "forward 3",
    "forward 4",
    "down 9",
    "down 2",
    "forward 5",
    "forward 8",
    "up 2",
    "forward 9",
    "up 5",
    "down 1",
    "forward 1",
    "forward 6",
    "forward 9",
    "forward 2",
    "down 8",
    "forward 1",
    "up 8",
    "forward 1",
    "forward 8",
    "up 5",
    "forward 3",
    "down 4",
    "up 8",
    "down 6",
    "up 1",
    "forward 2",
    "forward 4",
    "up 6",
    "forward 1",
    "forward 4",
    "up 6",
    "down 8",
    "up 7",
    "forward 5",
    "up 7",
    "down 9",
    "down 2",
    "up 5",
    "forward 2",
    "down 7",
    "forward 1",
    "forward 1",
    "forward 3",
    "down 6",
    "forward 7",
    "up 2",
    "up 1",
    "forward 1",
    "up 5",
    "down 1",
    "forward 7",
    "up 9",
    "forward 7",
    "down 6",
    "up 4",
    "down 5",
    "up 2",
    "down 4",
    "up 3",
    "down 6",
    "down 7",
    "down 7",
    "up 1",
    "forward 4",
    "forward 1",
    "up 2",
    "down 7",
    "down 5",
    "forward 7",
    "forward 5",
    "forward 2",
    "down 4",
    "down 6",
    "down 8",
    "forward 9",
    "forward 8",
    "up 9",
    "forward 6",
    "down 6",
    "down 6",
    "down 8",
    "up 5",
    "forward 6",
    "down 6",
    "forward 5",
    "down 4",
    "down 6",
    "down 2",
    "up 3",
    "forward 1",
    "forward 8",
    "down 2",
    "forward 9",
    "forward 7",
    "forward 8",
    "forward 1",
    "down 8",
    "forward 1",
    "down 1",
    "forward 6",
    "forward 4",
    "forward 5",
    "up 9",
    "up 1",
    "down 7",
    "up 8",
    "down 5",
    "down 2",
    "forward 9",
    "up 2",
    "forward 6",
    "down 7",
    "down 7",
    "down 2",
    "down 6",
    "down 7",
    "forward 9",
    "up 2",
    "down 6",
    "forward 8",
    "forward 1",
    "down 3",
    "down 2",
    "forward 3",
    "forward 7",
    "down 3",
    "down 1",
    "down 4",
    "down 9",
    "forward 1",
    "down 6",
    "down 8",
    "down 4",
    "down 5",
    "down 5",
    "up 9",
    "forward 7",
    "down 9",
    "up 3",
    "up 5",
    "up 1",
    "forward 2",
    "forward 9",
    "down 3",
    "forward 1",
    "up 3",
    "forward 6",
    "up 2",
    "forward 7",
    "forward 5",
    "forward 8",
    "forward 7",
    "forward 8",
    "down 5",
    "up 3",
    "forward 5",
    "forward 8",
    "forward 1",
    "forward 5",
    "forward 7",
    "forward 2",
    "down 6",
    "down 6",
    "down 6",
    "down 2",
    "down 2",
    "up 1",
    "down 1",
    "forward 5",
    "forward 7",
    "down 4",
    "forward 4",
    "up 1",
    "forward 7",
    "forward 8",
    "down 5",
    "down 2",
    "down 2",
    "down 5",
    "forward 3",
    "forward 7",
    "down 5",
    "forward 2",
    "forward 8",
    "down 3",
    "forward 6",
    "up 1",
    "forward 7",
    "forward 4",
    "forward 1",
    "forward 9",
    "forward 2",
    "down 1",
    "down 1",
    "down 8",
    "forward 4",
    "down 6",
    "forward 7",
    "forward 2"
);

constexpr static std::size_t part_1 = parse<
    // forward
    [](char const* command, position_t& position) constexpr noexcept{
        position.horizontal += str_to_int<std::size_t>(command + 8, nullptr);
    },
    // down
    [](char const* command, position_t& position) constexpr noexcept{
        position.depth += str_to_int<std::size_t>(command + 5, nullptr);
    },
    // up
    [](char const* command, position_t& position) constexpr noexcept{
        position.depth -= str_to_int<std::size_t>(command + 3, nullptr);
    }
>(input);

constexpr static std::size_t part_2 = parse<
    // forward
    [](char const* command, position_t& position) constexpr noexcept{
        auto value = str_to_int<std::size_t>(command + 8, nullptr);
        position.horizontal += value;
        position.depth += position.aim * value;
    },
    // down
    [](char const* command, position_t& position) constexpr noexcept{
        position.aim += str_to_int<std::size_t>(command + 5, nullptr);
    },
    // up
    [](char const* command, position_t& position) constexpr noexcept{
        position.aim -= str_to_int<std::size_t>(command + 3, nullptr);
    }
>(input);

int main(){
    std::cout << "Answer to part 1: " << part_1 << std::endl;
    std::cout << "Answer to part 2: " << part_2 << std::endl;
    return 0;
}
